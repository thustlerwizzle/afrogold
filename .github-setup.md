# GitHub OAuth Setup Guide

## Step 1: Create a GitHub OAuth App

1. Go to https://github.com/settings/developers
2. Click "New OAuth App"
3. Fill in the details:
   - **Application name**: AfroGold
   - **Homepage URL**: `http://localhost:3000` (for dev) or your production URL
   - **Authorization callback URL**: `http://localhost:3000/auth/github/callback` (for dev) or `https://yourdomain.com/auth/github/callback`
4. Click "Register application"
5. Copy the **Client ID** (you'll need this)
6. Generate a **Client Secret** (copy this too - you'll need it for backend)

## Step 2: Configure Environment Variables

Create a `.env` file in the root directory:

```env
REACT_APP_GITHUB_CLIENT_ID=your_client_id_here
REACT_APP_GITHUB_REDIRECT_URI=http://localhost:3000/auth/github/callback
```

For production, update:
```env
REACT_APP_GITHUB_REDIRECT_URI=https://yourdomain.com/auth/github/callback
```

## Step 3: Set Up Backend Proxy (Required)

GitHub OAuth requires a backend to securely exchange the authorization code for an access token. You have two options:

### Option A: Simple Node.js Backend

Create `backend/github-auth.js`:

```javascript
const express = require('express');
const cors = require('cors');
const axios = require('axios');

const app = express();
app.use(cors());
app.use(express.json());

app.post('/github/token', async (req, res) => {
  const { code, redirect_uri } = req.body;
  
  try {
    const response = await axios.post('https://github.com/login/oauth/access_token', {
      client_id: process.env.GITHUB_CLIENT_ID,
      client_secret: process.env.GITHUB_CLIENT_SECRET,
      code,
      redirect_uri
    }, {
      headers: { 'Accept': 'application/json' }
    });
    
    res.json({ access_token: response.data.access_token });
  } catch (error) {
    res.status(500).json({ error: 'Failed to exchange token' });
  }
});

app.listen(3001, () => console.log('Auth proxy running on port 3001'));
```

Then set in `.env`:
```env
REACT_APP_GITHUB_AUTH_PROXY=http://localhost:3001
```

### Option B: Serverless Function (Netlify/Vercel)

**Netlify Function** (`netlify/functions/github-auth.js`):

```javascript
exports.handler = async (event) => {
  if (event.httpMethod !== 'POST') {
    return { statusCode: 405, body: 'Method Not Allowed' };
  }
  
  const { code, redirect_uri } = JSON.parse(event.body);
  
  const response = await fetch('https://github.com/login/oauth/access_token', {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json',
      'Accept': 'application/json'
    },
    body: JSON.stringify({
      client_id: process.env.GITHUB_CLIENT_ID,
      client_secret: process.env.GITHUB_CLIENT_SECRET,
      code,
      redirect_uri
    })
  });
  
  const data = await response.json();
  
  return {
    statusCode: 200,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ access_token: data.access_token })
  };
};
```

**Vercel Function** (`api/github-auth.js`):

```javascript
export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method Not Allowed' });
  }
  
  const { code, redirect_uri } = req.body;
  
  const response = await fetch('https://github.com/login/oauth/access_token', {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json',
      'Accept': 'application/json'
    },
    body: JSON.stringify({
      client_id: process.env.GITHUB_CLIENT_ID,
      client_secret: process.env.GITHUB_CLIENT_SECRET,
      code,
      redirect_uri
    })
  });
  
  const data = await response.json();
  res.json({ access_token: data.access_token });
}
```

## Step 4: Add Routing (if using React Router)

If you're using React Router, add the callback route in `src/App.tsx`:

```typescript
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import GitHubCallback from './components/GitHubCallback';

// In your Router:
<Routes>
  <Route path="/auth/github/callback" element={<GitHubCallback />} />
  {/* other routes */}
</Routes>
```

## Step 5: Test

1. Start your app: `npm start`
2. Click "Continue with GitHub"
3. You'll be redirected to GitHub for authorization
4. After approval, you'll be redirected back and logged in

## Security Notes

- Never expose your Client Secret in frontend code
- Always use HTTPS in production
- The state parameter helps prevent CSRF attacks
- Store tokens securely (consider httpOnly cookies for production)

## Troubleshooting

- **"Client ID not configured"**: Make sure `REACT_APP_GITHUB_CLIENT_ID` is set in `.env`
- **"Failed to exchange token"**: Check your backend proxy is running and `GITHUB_CLIENT_SECRET` is set
- **CORS errors**: Make sure your backend has CORS enabled
- **Callback URL mismatch**: Ensure the callback URL in GitHub matches exactly (including http/https)

